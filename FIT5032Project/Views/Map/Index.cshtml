@model IEnumerable<FIT5032Project.Models.Item>

@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h2>Index</h2>

<p>
    @Html.ActionLink("Create New", "Create")
</p>
<div id="calendar"></div>
<div style="display: none">
    <table class="table">
        <tr>
            <th>
                @Html.DisplayNameFor(model => model.Name)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Priority)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.StartTime)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.EndTime)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Date)
            </th>
            <th></th>
        </tr>

        @foreach (var item in Model)
        {
            <tr class="events">
                <td class="title">
                    @Html.DisplayFor(modelItem => item.Name)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.Priority)
                </td>
                <td class="start">
                    @Html.DisplayFor(modelItem => item.StartTime)
                </td>
                <td class="end">
                    @Html.DisplayFor(modelItem => item.EndTime)
                </td>
                <td class="date">
                    @Html.DisplayFor(modelItem => item.Date)
                </td>
                <td>
                    @Html.ActionLink("Edit", "Edit", new { id = item.Id }) |
                    @Html.ActionLink("Details", "Details", new { id = item.Id }) |
                    @Html.ActionLink("Delete", "Delete", new { id = item.Id })
                </td>
            </tr>
        }

    </table>
</div>

@section Styles{
    @*<link href="~/Content/fullcalendar.css" rel="stylesheet" />
        <link href="~/Content/fullcalendar.print.css" rel="stylesheet" />*@
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fullcalendar@5.3.2/main.min.css">
}

@section Scripts{
    @*@Scripts.Render("~/bundles/fullcalendar")*@
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.3.2/main.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js" integrity="sha512-qTXRIMyZIFb8iQcfjXWCO8+M5Tbc38Qi5WzdPOYZHIlZpzBHG3L3by84BBBOiRGiEb7KKtAOAs5qYdUiZiQNNQ==" crossorigin="anonymous"></script>
    <script>
        var events = [];

        $(".events").each(function () {
            var title = $(".title", this).text().trim();
            var start = $(".start", this).text().trim();
            var end = $(".end", this).text().trim
            var date = $(".date", this).text().trim();

            // tell moment how to parse the input string
            var momentObjStart = moment(date + start, 'DD-MM-YYYYLT');
            var momentObjEnd = moment(date + end, 'DD-MM-YYYYLT');
            let duration = momentObjEnd.diff(momentObjStart, 'hours', true);
            if (duration < 0) {
                duration += 24;
            }

            // conversion
            var dateTimeStart = momentObjStart.format('YYYY-MM-DDTHH:mm');

            var event = {
                "title": title,
                "start": dateTimeStart,
                "end": momentObjStart.add(duration, 'hours').format('YYYY-MM-DDTHH:mm')
            };
            events.push(event);
        });

        console.log(events)
        let calendarEl = document.getElementById("calendar");
        let calendar = new FullCalendar.Calendar(calendarEl, {
            initialView: 'timeGridWeek',
            events: events
        });

        calendar.render();
    </script>

}
